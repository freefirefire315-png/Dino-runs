<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dino Run - Earn Ton</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Courier New', Courier, monospace; background: #87CEEB; touch-action: none; -webkit-user-select: none; }
        #game { width: 100vw; height: 300px; background: #f7f7f7; position: relative; border-bottom: 4px solid #535353; margin-top: 50px; overflow: hidden; }
        #dino { width: 50px; height: 50px; position: absolute; bottom: 0; left: 40px; font-size: 40px; z-index: 10; transform: scaleX(-1); }
        .obstacle { position: absolute; bottom: 0; font-size: 30px; z-index: 11; }
        #ui { padding: 15px; display: flex; justify-content: space-between; font-size: 20px; color: #535353; font-weight: bold; background: #f7f7f7; }
        #restart { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border: 3px solid #535353; border-radius: 15px; text-align: center; z-index: 100; width: 250px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        button { width: 100%; padding: 15px; margin-top: 10px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; color: white; }
        .btn-revive { background: #2ecc71; border-bottom: 4px solid #27ae60; }
        .btn-retry { background: #535353; }
        #status-msg { font-size: 12px; color: #888; margin-top: 10px; }
    </style>
</head>
<body onclick="jump()" ontouchstart="jump()">

    <div id="ui">
        <span>HI <span id="high-score">00000</span></span>
        <span id="score">00000</span>
    </div>

    <div id="game">
        <div id="dino">ðŸ¦–</div>
    </div>

    <div id="restart">
        <h2 style="margin: 0 0 15px 0; color: #535353;">GAME OVER</h2>
        <button id="revive-btn" class="btn-revive">ðŸ“º WATCH AD TO REVIVE</button>
        <button onclick="location.reload()" class="btn-retry">RETRY</button>
        <p id="status-msg">Revive only available once per run</p>
    </div>

<script>
    // --- 1. CONFIGURATION ---
    const adBlockId = "19286"; // <--- PUT YOUR ADSGRAM BLOCK ID HERE
    
    const AdController = window.Adsgram.init({ blockId: adBlockId });
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    // --- 2. GAME VARIABLES ---
    const dino = document.getElementById("dino");
    const scoreTxt = document.getElementById("score");
    const restartDiv = document.getElementById("restart");
    const reviveBtn = document.getElementById("revive-btn");

    let score = 0, gameSpeed = 6, gameOver = false, canRevive = true;
    let position = 0, velocity = 0, isJumping = false;

    // --- 3. AD LOGIC (The Money Maker) ---
    reviveBtn.onclick = (e) => {
        e.stopPropagation(); // Prevent jump when clicking button
        
        // Show the Rewarded Ad
        AdController.show().then((result) => {
            // Success! User watched the ad.
            gameOver = false;
            canRevive = false; 
            restartDiv.style.display = "none";
            
            // Clear obstacles and resume
            document.querySelectorAll('.obstacle').forEach(o => o.remove());
            spawnObstacle();
            console.log("Ad completed. User rewarded with revive.");
        }).catch((err) => {
            // User skipped or ad failed
            alert("You must watch the full ad to revive!");
            console.error("Adsgram Error:", err);
        });
    };

    // --- 4. GAME ENGINE ---
    function jump() {
        if (position === 0 && !gameOver) {
            velocity = 12;
            if (!isJumping) {
                isJumping = true;
                requestAnimationFrame(physics);
            }
        }
    }

    function physics() {
        if (gameOver) { isJumping = false; return; }
        position += velocity;
        velocity -= 0.6; // Gravity
        
        if (position <= 0) {
            position = 0;
            velocity = 0;
            dino.style.bottom = "0px";
            isJumping = false;
            return;
        }
        
        dino.style.bottom = position + "px";
        requestAnimationFrame(physics);
    }

    function spawnObstacle() {
        if (gameOver) return;
        
        const ob = document.createElement("div");
        ob.classList.add("obstacle");
        ob.innerHTML = Math.random() > 0.5 ? "ðŸŒµ" : "ðŸŒµðŸŒµ";
        document.getElementById("game").appendChild(ob);
        
        let left = window.innerWidth;
        
        function move() {
            if (gameOver) return;
            left -= gameSpeed;
            ob.style.left = left + "px";
            
            let d = dino.getBoundingClientRect();
            let o = ob.getBoundingClientRect();
            
            // Collision detection
            if (d.right-15 > o.left && d.left+15 < o.right && d.bottom-5 > o.top) {
                endGame();
                return;
            }

            if (left < -100) {
                ob.remove();
                score++;
                scoreTxt.innerText = score.toString().padStart(5, '0');
                if (score % 10 === 0) gameSpeed += 0.5; // Gradually get harder
            } else {
                requestAnimationFrame(move);
            }
        }
        requestAnimationFrame(move);
        
        // Random time for next obstacle
        let nextSpawn = Math.random() * 1500 + (1000 - (gameSpeed * 20));
        setTimeout(spawnObstacle, Math.max(nextSpawn, 700));
    }

    function endGame() {
        gameOver = true;
        restartDiv.style.display = "block";
        reviveBtn.style.display = canRevive ? "block" : "none";
        document.getElementById("status-msg").innerText = canRevive ? 
            "Watch ad for a second chance!" : "Revive used this round.";
    }

    // Start
    spawnObstacle();
</script>
</body>
</html>
