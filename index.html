<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://adsgram.ai/sdk.js"></script>
    <style>
        body { margin: 0; background: #f0f0f0; font-family: sans-serif; overflow: hidden; touch-action: none; }
        #game { position: relative; width: 100vw; height: 200px; background: white; border-bottom: 4px solid #555; margin-top: 50px; }
        /* The Dino - A Green Box */
        #dino { position: absolute; bottom: 0; left: 50px; width: 35px; height: 35px; background: #2ecc71; border-radius: 4px; }
        /* The Cactus - A Red Box */
        .cactus { position: absolute; bottom: 0; width: 20px; height: 40px; background: #e74c3c; }
        #score { padding: 10px; font-size: 20px; font-weight: bold; }
        #menu { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); 
                display: none; flex-direction: column; align-items: center; justify-content: center; color: white; }
        button { padding: 15px 30px; font-size: 18px; cursor: pointer; border: none; border-radius: 8px; margin: 10px; }
    </style>
</head>
<body onclick="jump()">
    <div id="score">Score: 0</div>
    <div id="game">
        <div id="dino"></div>
    </div>
    <div id="menu">
        <h1>GAME OVER</h1>
        <button onclick="showAd()" style="background: #f1c40f;">ðŸ“º WATCH AD TO REVIVE</button>
        <button onclick="location.reload()" style="background: #95a5a6;">RESTART</button>
    </div>

<script>
    const dino = document.getElementById("dino");
    const game = document.getElementById("game");
    const menu = document.getElementById("menu");
    let score = 0;
    let isJumping = false;
    let isGameOver = false;

    // IMPORTANT: Get this from Adsgram.ai
    const AdController = window.Adsgram.init({ blockId: "4538" }); // Sample ID, replace with yours!

    function jump() {
        if (isJumping || isGameOver) return;
        isJumping = true;
        let pos = 0;
        let up = setInterval(() => {
            if (pos >= 100) {
                clearInterval(up);
                let down = setInterval(() => {
                    if (pos <= 0) { clearInterval(down); isJumping = false; }
                    pos -= 4;
                    dino.style.bottom = pos + "px";
                }, 20);
            }
            pos += 4;
            dino.style.bottom = pos + "px";
        }, 20);
    }

    function spawnCactus() {
        if (isGameOver) return;
        const cactus = document.createElement("div");
        cactus.classList.add("cactus");
        game.appendChild(cactus);
        let cactusPos = window.innerWidth;
        
        let move = setInterval(() => {
            if (isGameOver) { clearInterval(move); return; }
            cactusPos -= 5;
            cactus.style.left = cactusPos + "px";

            if (cactusPos < -20) {
                clearInterval(move);
                cactus.remove();
                score++;
                document.getElementById("score").innerText = "Score: " + score;
            }

            // Simple Collision Check
            let dinoTop = parseInt(window.getComputedStyle(dino).getPropertyValue("top"));
            if (cactusPos < 85 && cactusPos > 50 && dinoTop >= 165) {
                isGameOver = true;
                menu.style.display = "flex";
            }
        }, 20);

        setTimeout(spawnCactus, Math.random() * 2000 + 1000);
    }

    async function showAd() {
        AdController.show().then((result) => {
            if (result.done) {
                isGameOver = false;
                menu.style.display = "none";
                document.querySelectorAll('.cactus').forEach(c => c.remove());
                spawnCactus();
            }
        }).catch(() => { alert("No ads available! Restarting..."); location.reload(); });
    }

    spawnCactus();
    Telegram.WebApp.ready();
</script>
</body>
</html>
