<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dino Run</title>
    <script src="https://app.adsgram.ai/js/adsgram-ad-sdk.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { padding: 0; margin: 0; box-sizing: border-box; }
        body { background: #fff; font-family: sans-serif; overflow: hidden; touch-action: none; }
        #game { width: 100vw; height: 150px; border-bottom: 2px solid #535353; margin-top: 100px; position: relative; }
        
        /* Characters */
        #dino { width: 50px; height: 50px; position: absolute; bottom: 0; left: 40px; display: flex; align-items: center; justify-content: center; font-size: 40px; transition: bottom 0.1s; }
        #cactus { width: 40px; height: 40px; position: absolute; bottom: 0; right: -50px; display: flex; align-items: center; justify-content: center; font-size: 30px; }
        
        /* Simple Animations */
        .jumping { animation: jump-logic 0.6s linear; }
        @keyframes jump-logic {
            0% { bottom: 0; } 45% { bottom: 100px; } 55% { bottom: 100px; } 100% { bottom: 0; }
        }
        .moving { animation: move-logic 1.5s infinite linear; }
        @keyframes move-logic { 0% { right: -50px; } 100% { right: 110%; } }

        #score { position: absolute; top: 40px; right: 20px; font-size: 24px; font-weight: bold; }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; flex-direction: column; align-items: center; justify-content: center; color: white; z-index: 100; }
        button { padding: 15px; font-size: 18px; border: none; border-radius: 12px; background: #2ecc71; color: white; margin-top: 10px; width: 260px; font-weight: bold; }
    </style>
</head>
<body>
    <div id="score">0</div>
    <div id="game">
        <div id="dino">ðŸ¦–</div>
        <div id="cactus" class="moving">ðŸŒµ</div>
    </div>
    <div id="overlay">
        <h1>GAME OVER</h1>
        <p id="f-score">Score: 0</p>
        <button id="adBtn">ðŸ“º WATCH AD TO REVIVE</button>
        <button style="background:#e74c3c;" onclick="location.reload()">ðŸ”„ RESTART</button>
    </div>

    <script>
        // Start Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        const dino = document.getElementById("dino"), cactus = document.getElementById("cactus"), 
              scoreBox = document.getElementById("score"), overlay = document.getElementById("overlay");
        
        const AdController = window.Adsgram.init({ blockId: "19286" });
        let score = 0, isDead = false;

        // FORCE TOUCH RECOGNITION
        window.addEventListener('touchstart', function(e) {
            if (isDead) return;
            if (!dino.classList.contains("jumping")) {
                dino.classList.add("jumping");
                setTimeout(() => { dino.classList.remove("jumping"); }, 600);
            }
        });

        // Main Game Loop
        let mainLoop = setInterval(() => {
            if (isDead) return;

            let dBottom = parseInt(window.getComputedStyle(dino).bottom);
            let cLeft = parseInt(window.getComputedStyle(cactus).left);

            // Scoring
            score++;
            scoreBox.innerHTML = Math.floor(score/10);

            // Collision Detection
            if (cLeft < 80 && cLeft > 40 && dBottom < 35) {
                isDead = true;
                cactus.classList.remove("moving");
                overlay.style.display = "flex";
                document.getElementById("f-score").innerHTML = "Score: " + Math.floor(score/10);
            }
        }, 20);

        // Adsgram Revive Function
        document.getElementById("adBtn").onclick = async () => {
            try {
                const result = await AdController.show();
                if (result.done) {
                    isDead = false;
                    overlay.style.display = "none";
                    cactus.style.right = "-100px";
                    cactus.classList.add("moving");
                    score = score; // Continue from current score
                }
            } catch (e) {
                location.reload();
            }
        };
    </script>
</body>
</html>
